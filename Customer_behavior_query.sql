-- ADDING COLUMN
ALTER TABLE CUSTOMER_BEHAVIOR
ADD purchases_frequency_days INT


--INSERTING VALUES
UPDATE Customer_behavior
SET purchases_frequency_days= CASE
WHEN frequency_of_purchases = 'Fortnightly' THEN 14
WHEN frequency_of_purchases = 'WEEKLY' THEN 7
WHEN frequency_of_purchases = 'Quarterly' THEN 90
ELSE 365 END 



--ADDING COLUMN
alter table customer_behavior
add age_group varchar(20)


--INSERTNG VALUES
update Customer_behavior
SET age_group = CASE
WHEN age < 28 then 'Young Adult'
WHEN age < 60 then 'Middle Aged'
ELSE 'Senior'
END


--WHAT IS THE TOTAL REVENUE GENERATED BY MALE VS. FEMALE CUSTOMERS?
SELECT Gender, SUM(PURCHASE_AMOUNT) AS Revenue
FROM Customer_behavior
GROUP BY GENDER



--WHICH CUSTOMERS USED A DISCOUNT BUT STILL SPENT MORE THAN THE AVERAGE PURCHASE AMOUNT?
SELECT customer_id,purchase_amount  from Customer_behavior where discount_applied = 'Yes' and purchase_amount>=
(SELECT AVG(PURCHASE_AMOUNT) FROM Customer_behavior)


--WHICH ARE THE TOP 5 PRODUCTS WITH THE HIGHEST AVERAGE REVIEW RATING?
SELECT TOP 5 Item_purchased, ROUND(AVG(REVIEW_RATING),2) AS Avg_review_rating
from Customer_behavior
group by ITEM_PURCHASED
order by AVG(REVIEW_RATING) desc



--COMPARE THE AVERAGE PURCHASE AMOUNT BETWEEN STANDARD AND EXPRESS SHIPPING?
SELECT Shipping_type,AVG(PURCHASE_AMOUNT) AS Avg_purchase_amount
FROM CUSTOMER_BEHAVIOR
WHERE SHIPPING_TYPE IN ('STANDARD', 'EXPRESS')
GROUP BY SHIPPING_TYPE



--DO SUBSCRIBED CUSTOMERS SPEND MORE? COMPARE AVERAGE SPEND AND TOTAL REVENUE BETWEEN SUBSCRIBERS
--AND NON SUBSCRIBERS.
SELECT SUBSCRIPTION_STATUS,
COUNT(CUSTOMER_ID) AS TOTAL_CUSTOMERS,
AVG(PURCHASE_AMOUNT) AS AVG_PURCHASE_AMOUNT,
SUM(PURCHASE_AMOUNT) AS REVENUE
FROM Customer_behavior
GROUP BY SUBSCRIPTION_STATUS
ORDER BY REVENUE DESC




--WHICH 5 PRODUCTS HAVE THE HIGHEST PERCENTAGE OF PURCHASES WITH DISCOUNTS APPLIED?
SELECT  TOP 5 Item_purchased, 
(100* SUM(case when discount_applied ='Yes' then 1 else 0 end) / count(*)) as Discount_rate
from Customer_behavior
group by ITEM_PURCHASED
order by discount_rate desc



--SEGMENTS CUSTOMERS INTO NEW, RETURNING AND LOYAL BASED
--ON THEIR TOTAL NUMBER OF PREVIOUS PURCHASES AND SHOW THE COUNT OF EACH SEGMENT.
with cte as
(SELECT CUSTOMER_ID, PREVIOUS_PURCHASES,
CASE WHEN PREVIOUS_PURCHASES = 1 THEN 'New'
WHEN PREVIOUS_PURCHASES BETWEEN 2 AND 10 THEN 'Returning'
ELSE 'Loyal'
end as Customer_segments
from Customer_behavior)
SELECT customer_segments, COUNT(*) AS 'Number of customers'FROM CTE
group by customer_segments
order by 'Number of customers'desc





--WHAT ARE THE TOP 3 MOST PURCHASED PRODUCTS WITHIN EACH CATEGORY?
WITH CTE AS 
(
SELECT CATEGORY,  ITEM_PURCHASED,
COUNT(CUSTOMER_ID) AS TOTAL_ORDERS,
ROW_NUMBER() OVER (PARTITION BY CATEGORY ORDER BY COUNT(CUSTOMER_ID) DESC) AS ITEM_RANK
FROM Customer_behavior
GROUP BY CATEGORY, ITEM_PURCHASED
)
SELECT ITEM_RANK,CATEGORY,ITEM_PURCHASED,TOTAL_ORDERS
FROM CTE 
WHERE ITEM_RANK<= 3




--ARE CUSTOMERS WHO ARE REPEAT BUYERS (MORE THAN 5 PREVIOUS PUCHASES ) ALSO LIKLY TO SUBSCRIBE?
SELECT SUBSCRIPTION_STATUS,
COUNT(CUSTOMER_ID) AS REPEAT_BUYERS
FROM Customer_behavior
WHERE PREVIOUS_PURCHASES > 5
GROUP BY SUBSCRIPTION_STATUS



--WHAT IS THE REVENUE CONTRIBUTION OF EACH AGE GROUP?
SELECT AGE_GROUP,SUM(PURCHASE_AMOUNT) AS REVENUE
FROM Customer_behavior
GROUP BY AGE_GROUP






















































 

















